\doxysection{esp1\+\_\+rfid\+\_\+motion/\+esp1\+\_\+rfid\+\_\+motion.ino File Reference}
\hypertarget{esp1__rfid__motion_8ino}{}\label{esp1__rfid__motion_8ino}\index{esp1\_rfid\_motion/esp1\_rfid\_motion.ino@{esp1\_rfid\_motion/esp1\_rfid\_motion.ino}}


RFID + PIN based access controller with LCD, motion sensing, and MQTT.  


Include dependency graph for esp1\+\_\+rfid\+\_\+motion.\+ino:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum class \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} :\+ uint8\+\_\+t \{ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Denied}}
, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{Granted}}
, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Denied}}
, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{Granted}}
 \}
\begin{DoxyCompactList}\small\item\em Access result enumeration. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
MFRC522 \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}} (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a740060cb86c3a8429646211325d378cb}{RFID\+\_\+\+SS\+\_\+\+PIN}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a5ddbb36ee43b0702d33a13226adfd364}{RFID\+\_\+\+RST\+\_\+\+PIN}})
\begin{DoxyCompactList}\small\item\em MFRC522 RFID reader instance. \end{DoxyCompactList}\item 
Liquid\+Crystal\+\_\+\+I2C \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}} (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_aa68f1d788c8105e0735aac60d3df262f}{LCD\+\_\+\+ADDRESS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a0e6a68e678ddbbb64d3a90350409eb77}{LCD\+\_\+\+COLUMNS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ae8842648f085d102ff0d7b1f06896143}{LCD\+\_\+\+ROWS}})
\begin{DoxyCompactList}\small\item\em I2C LCD instance. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcd\+Print\+Line}} (const \+\_\+\+\_\+\+Flash\+String\+Helper \texorpdfstring{$\ast$}{*}msg, uint8\+\_\+t line)
\begin{DoxyCompactList}\small\item\em Clears an LCD line and prints a flash-\/resident string. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a79a958a99f2c3f644266594c7df27b97}{lcd\+Print\+Line}} (const char \texorpdfstring{$\ast$}{*}msg, uint8\+\_\+t line)
\begin{DoxyCompactList}\small\item\em Clears an LCD line and prints a RAM-\/resident string. \end{DoxyCompactList}\item 
static void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_aff8c04e7b324ff4272911924db174640}{force\+Lock}} ()
\begin{DoxyCompactList}\small\item\em Forces the system back into locked idle state. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ac8b922f2a416a064034b689152827cce}{make\+Entered\+Pins}} (uint8\+\_\+t pin\+Length)
\begin{DoxyCompactList}\small\item\em Builds a masked PIN string for LCD display. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ac3a129f66dc859e2b7279565f4e1de78}{callback}} (char \texorpdfstring{$\ast$}{*}topic, byte \texorpdfstring{$\ast$}{*}payload, unsigned int length)
\begin{DoxyCompactList}\small\item\em MQTT message callback handler. \end{DoxyCompactList}\item 
bool \doxymbox{\hyperlink{esp1__rfid__motion_8ino_afd31f405375298b91360c711cad4200f}{is\+Display\+Active}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Checks whether the LCD backlight should remain active. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ade59c900943c3305d0209fb836346d95}{on\+Motion\+Detected}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Handles motion-\/detected events. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_acafc4192a261b10303c3d691ac3f3340}{on\+Motion\+Idle}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Handles motion-\/idle state. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8df5568d50795a11cfd7fb0abb331131}{update\+Motion\+State}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Updates motion state based on PIR sensor input. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ac37295ff76a33dc6395fbeb6906267fd}{uid\+To\+Hex\+String}} (const MFRC522::\+\+Uid \&uid, char \texorpdfstring{$\ast$}{*}output, size\+\_\+t output\+Size)
\begin{DoxyCompactList}\small\item\em Converts an RFID UID to a hexadecimal string. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_aee754d5a9a7adc964e2458c556d31728}{handle\+RFID}} ()
\begin{DoxyCompactList}\small\item\em Handles RFID card detection and request publishing. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a4fc01d736fe50cf5b977f755b675f11d}{setup}} ()
\begin{DoxyCompactList}\small\item\em Arduino setup function. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{esp1__rfid__motion_8ino_afe461d27b9c48d5921c00d521181f12f}{loop}} ()
\begin{DoxyCompactList}\small\item\em Arduino main loop. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
Wifi\+Mqtt\+Client \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}
\begin{DoxyCompactList}\small\item\em Wi\+Fi + MQTT client wrapper. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ae4ee394ecd24781bba5d0aaaab8e964a}{WIFI\+\_\+\+SSID}} \+[$\,$]\+ = "{}Mathias2.\+4"{}
\begin{DoxyCompactList}\small\item\em Wi\+Fi SSID. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a0495958e0c537c1c5100ee272495435c}{WIFI\+\_\+\+PASS}} \+[$\,$]\+ = "{}mrbombasticcallmefantastic"{}
\begin{DoxyCompactList}\small\item\em Wi\+Fi password. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a41c34e432b12a511f9348547ddae11d4}{MQTT\+\_\+\+HOST}} \+[$\,$]\+ = "{}maqiatto.\+com"{}
\begin{DoxyCompactList}\small\item\em MQTT broker hostname. \end{DoxyCompactList}\item 
constexpr uint16\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a993a7e0c0377e10146438ebe707f31d0}{MQTT\+\_\+\+PORT}} = 1883
\begin{DoxyCompactList}\small\item\em MQTT broker port. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a315cd313c3f6301b48d2f67e63bec2db}{MQTT\+\_\+\+USER}} \+[$\,$]\+ = "{}hectorfoss@gmail.\+com"{}
\begin{DoxyCompactList}\small\item\em MQTT username. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a31dacdc924feb376b49448eb843d053c}{MQTT\+\_\+\+PASS}} \+[$\,$]\+ = "{}potter"{}
\begin{DoxyCompactList}\small\item\em MQTT password. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04ecc29c762e5b2844d3c24744813015}{DEVICE\+\_\+\+ID}} \+[$\,$]\+ = "{}door1"{}
\begin{DoxyCompactList}\small\item\em Unique device identifier used in MQTT topics. \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a740060cb86c3a8429646211325d378cb}{RFID\+\_\+\+SS\+\_\+\+PIN}} = 15
\begin{DoxyCompactList}\small\item\em RC522 SPI Slave Select pin (D8 /\+ GPIO15). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a5ddbb36ee43b0702d33a13226adfd364}{RFID\+\_\+\+RST\+\_\+\+PIN}} = 16
\begin{DoxyCompactList}\small\item\em RC522 Reset pin (D0 /\+ GPIO16). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8e9966a29ec4b464131da8cb1825ceb5}{MOTION\+\_\+\+PIN}} = 0
\begin{DoxyCompactList}\small\item\em Motion sensor pin (D3 /\+ GPIO0). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a63fd3c54e4843404005eeeb206227853}{I2\+C\+\_\+\+SDA\+\_\+\+PIN}} = 4
\begin{DoxyCompactList}\small\item\em I2C SDA pin for LCD (D2 /\+ GPIO4). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a9f6ed03d2d1d74a449ea68a62185786b}{I2\+C\+\_\+\+SCL\+\_\+\+PIN}} = 5
\begin{DoxyCompactList}\small\item\em I2C SCL pin for LCD (D1 /\+ GPIO5). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a0e6a68e678ddbbb64d3a90350409eb77}{LCD\+\_\+\+COLUMNS}} = 16
\begin{DoxyCompactList}\small\item\em Number of LCD columns. \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ae8842648f085d102ff0d7b1f06896143}{LCD\+\_\+\+ROWS}} = 2
\begin{DoxyCompactList}\small\item\em Number of LCD rows. \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_aa68f1d788c8105e0735aac60d3df262f}{LCD\+\_\+\+ADDRESS}} = 0x27
\begin{DoxyCompactList}\small\item\em I2C address of the LCD module. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b}{DISPLAY\+\_\+\+MS}} = 3000
\begin{DoxyCompactList}\small\item\em Duration (ms) to display text before resetting. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7ac35d96245159cab011565a97a600a2}{DISPLAY\+\_\+\+BACKLIGHT\+\_\+\+MS}} = 5000
\begin{DoxyCompactList}\small\item\em Duration (ms) to keep LCD backlight on after motion. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1437df78a60c0b4cbfba394adb0451d2}{PIN\+\_\+\+TIME\+\_\+\+MS}} = 15000
\begin{DoxyCompactList}\small\item\em Time window (ms) for entering PIN after RFID success. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6d6d37a1e68b6dcd10e646ed685f6f5e}{UNLOCK\+\_\+\+TIME\+\_\+\+MS}} = 5000
\begin{DoxyCompactList}\small\item\em Door unlock display duration (ms). \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af9d4cdbb45bf12608e163ee4b2d0dadd}{POLL\+\_\+\+MS}} = 30
\begin{DoxyCompactList}\small\item\em Main loop polling delay (ms). \end{DoxyCompactList}\item 
\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfid\+Access}}
\begin{DoxyCompactList}\small\item\em Result of RFID authentication. \end{DoxyCompactList}\item 
\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a39d1ef76cb1d31fc16d855c63df5624a}{access\+Granted}}
\begin{DoxyCompactList}\small\item\em Result of PIN verification. \end{DoxyCompactList}\item 
bool \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}} = false
\begin{DoxyCompactList}\small\item\em Indicates whether a status message is currently displayed. \end{DoxyCompactList}\item 
uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{show\+Text\+Until}} = 0
\begin{DoxyCompactList}\small\item\em Timestamp (ms) when the displayed text should expire. \end{DoxyCompactList}\item 
uint32\+\_\+t \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a25ac0b6f6c871d8fcaf0a438f1d8f46a}{show\+Display\+Until}} = 0
\begin{DoxyCompactList}\small\item\em Timestamp (ms) when LCD backlight should turn off. \end{DoxyCompactList}\item 
bool \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb}{motion\+Active}} = false
\begin{DoxyCompactList}\small\item\em Indicates whether motion is currently considered active. \end{DoxyCompactList}\item 
static char \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb}{entered\+Pins}} \+[5]\+ = "{} "{}
\begin{DoxyCompactList}\small\item\em Masked PIN buffer shown on LCD (max 4 digits + null terminator). \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
RFID + PIN based access controller with LCD, motion sensing, and MQTT. 



Definition in file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



\label{doc-enum-members}
\Hypertarget{esp1__rfid__motion_8ino_doc-enum-members}
\doxysubsection{Enumeration Type Documentation}
\Hypertarget{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!AccessResult@{AccessResult}}
\index{AccessResult@{AccessResult}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{AccessResult}{AccessResult}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1} 
enum class \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} :\+ uint8\+\_\+t\hspace{0.3cm}{\ttfamily [strong]}}



Access result enumeration. 

\begin{DoxyEnumFields}[2]{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{Denied@{Denied}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!Denied@{Denied}}
}\Hypertarget{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}\label{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73} 
Denied&Access denied. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{Granted@{Granted}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!Granted@{Granted}}
}\Hypertarget{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}\label{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db} 
Granted&Access granted. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{Denied@{Denied}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!Denied@{Denied}}
}\Hypertarget{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}\label{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73} 
Denied&Access denied. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{Granted@{Granted}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!Granted@{Granted}}
}\Hypertarget{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}\label{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db} 
Granted&Access granted. \\
\hline

\end{DoxyEnumFields}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00140}{140}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ uint8\_t\ \{}
\DoxyCodeLine{00141\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Denied}},\ \ \ }
\DoxyCodeLine{00142\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{Granted}}\ \ \ }
\DoxyCodeLine{00143\ \};}

\end{DoxyCode}


\label{doc-func-members}
\Hypertarget{esp1__rfid__motion_8ino_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{esp1__rfid__motion_8ino_ac3a129f66dc859e2b7279565f4e1de78}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!callback@{callback}}
\index{callback@{callback}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{callback()}{callback()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ac3a129f66dc859e2b7279565f4e1de78} 
void callback (\begin{DoxyParamCaption}\item[{char \texorpdfstring{$\ast$}{*}}]{topic}{, }\item[{byte \texorpdfstring{$\ast$}{*}}]{payload}{, }\item[{unsigned int}]{length}{}\end{DoxyParamCaption})}



MQTT message callback handler. 

Parses incoming JSON messages and dispatches logic based on topic:\+
\begin{DoxyItemize}
\item RFID access decision
\item Keypad PIN validation result
\item Keypad keypress feedback
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em topic} & MQTT topic string. \\
\hline
{\em payload} & Raw payload bytes. \\
\hline
{\em length} & Payload length. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{250}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00251\ \ \ \textcolor{comment}{//\ Ignore\ empty\ MQTT\ messages}}
\DoxyCodeLine{00252\ \ \ \textcolor{keywordflow}{if}\ (length\ ==\ 0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ StaticJsonDocument<512>\ doc;}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{comment}{//\ Deserialize\ JSON\ payload\ into\ document}}
\DoxyCodeLine{00257\ \ \ DeserializationError\ err\ =\ deserializeJson(doc,\ payload,\ length);}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{comment}{//\ Abort\ if\ JSON\ parsing\ fails}}
\DoxyCodeLine{00260\ \ \ \textcolor{keywordflow}{if}\ (err)\ \{}
\DoxyCodeLine{00261\ \ \ \ \ Serial.print(\textcolor{stringliteral}{"{}JSON\ parse\ failed:\ "{}});}
\DoxyCodeLine{00262\ \ \ \ \ Serial.println(err.c\_str());}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00267\ \ \ \textcolor{comment}{//\ RFID\ access\ response}}
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordflow}{if}\ (strcmp(topic,\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.makeTopic(\textcolor{stringliteral}{"{}access/response"{}}).c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{comment}{//\ Timestamp\ when\ request\ was\ sent\ (provided\ by\ backend)}}
\DoxyCodeLine{00272\ \ \ \ \ uint32\_t\ requestMs\ =\ doc[\textcolor{stringliteral}{"{}sent\_ts\_ms"{}}]\ |\ 0;}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{comment}{//\ Compute\ round-\/trip\ delay\ to\ detect\ stale\ responses}}
\DoxyCodeLine{00275\ \ \ \ \ uint32\_t\ deltaMs\ =\ millis()\ -\/\ requestMs;}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ Serial.printf(}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Request/Response\ time\ diff:\ \%lu\ ms\(\backslash\)n"{}},}
\DoxyCodeLine{00279\ \ \ \ \ \ \ deltaMs}
\DoxyCodeLine{00280\ \ \ \ \ );}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{comment}{//\ Ignore\ responses\ that\ took\ too\ long\ to\ arrive}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{if}\ (deltaMs\ >\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b}{DISPLAY\_MS}})\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Took\ too\ long\ to\ respond"{}});}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00286\ \ \ \ \ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{comment}{//\ Extract\ access\ decision\ from\ JSON\ payload}}
\DoxyCodeLine{00289\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfidAccess}}\ =\ (doc[\textcolor{stringliteral}{"{}response"{}}][\textcolor{stringliteral}{"{}hasAccess"{}}]\ |\ \textcolor{keyword}{false})}
\DoxyCodeLine{00290\ \ \ \ \ \ \ ?\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{AccessResult::Granted}}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ :\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{AccessResult}}::\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Denied}};}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}UID\ match:\ waiting\ for\ PIN..."{}});}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{comment}{//\ Handle\ denied\ RFID\ access\ immediately}}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfidAccess}}\ !=\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{AccessResult::Granted}})\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Access\ Denied"{}}),\ 0);}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{showTextUntil}}\ =\ millis()\ +\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b}{DISPLAY\_MS}};}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00301\ \ \ \ \ \}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{comment}{//\ Prompt\ user\ to\ enter\ PIN\ after\ successful\ RFID}}
\DoxyCodeLine{00304\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Enter\ PIN:"{}}),\ 0);}
\DoxyCodeLine{00305\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00306\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{showTextUntil}}\ =\ millis()\ +\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1437df78a60c0b4cbfba394adb0451d2}{PIN\_TIME\_MS}};}
\DoxyCodeLine{00307\ \ \ \ \ }
\DoxyCodeLine{00308\ \ \ \}\ }
\DoxyCodeLine{00309\ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00310\ \ \ \textcolor{comment}{//\ Keypad\ PIN\ verification\ response}}
\DoxyCodeLine{00311\ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcmp(topic,\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.makeTopic(\textcolor{stringliteral}{"{}access/keypad\_response"{}}).c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{comment}{//\ Ignore\ PIN\ responses\ if\ RFID\ was\ not\ authorized}}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfidAccess}}\ !=\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{AccessResult::Granted}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{comment}{//\ Extract\ PIN\ validation\ result}}
\DoxyCodeLine{00318\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a39d1ef76cb1d31fc16d855c63df5624a}{accessGranted}}\ =\ (doc[\textcolor{stringliteral}{"{}response"{}}][\textcolor{stringliteral}{"{}accessGranted"{}}]\ |\ \textcolor{keyword}{false})}
\DoxyCodeLine{00319\ \ \ \ \ \ \ ?\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{AccessResult::Granted}}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ :\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{AccessResult}}::\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Denied}};}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{comment}{//\ Handle\ incorrect\ PIN}}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a39d1ef76cb1d31fc16d855c63df5624a}{accessGranted}}\ !=\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{AccessResult::Granted}})\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Access\ Denied"{}});}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Access\ Denied"{}}),\ 0);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{showTextUntil}}\ =\ millis()\ +\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b}{DISPLAY\_MS}};}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00329\ \ \ \ \ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{comment}{//\ Handle\ successful\ authentication}}
\DoxyCodeLine{00332\ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}Access\ Granted"{}});}
\DoxyCodeLine{00333\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Access\ Granted"{}}),\ 0);}
\DoxyCodeLine{00334\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00335\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{showTextUntil}}\ =\ millis()\ +\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6d6d37a1e68b6dcd10e646ed685f6f5e}{UNLOCK\_TIME\_MS}};}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \}}
\DoxyCodeLine{00338\ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00339\ \ \ \textcolor{comment}{//\ Keypad\ visual\ feedback\ (keypress)}}
\DoxyCodeLine{00340\ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00341\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strcmp(topic,\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.makeTopic(\textcolor{stringliteral}{"{}keypad/beep"{}}).c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ Only\ show\ keypad\ feedback\ after\ successful\ RFID}}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfidAccess}}\ !=\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{AccessResult::Granted}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ Number\ of\ digits\ entered\ so\ far}}
\DoxyCodeLine{00347\ \ \ \ \ uint8\_t\ pinLength\ =\ doc[\textcolor{stringliteral}{"{}data"{}}][\textcolor{stringliteral}{"{}pinlength"{}}]\ |\ 0;}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{comment}{//\ Update\ masked\ PIN\ display}}
\DoxyCodeLine{00350\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ac8b922f2a416a064034b689152827cce}{makeEnteredPins}}(pinLength);}
\DoxyCodeLine{00351\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb}{enteredPins}},\ 1);}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00149}{access\+Granted}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00141}{Denied}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00109}{DISPLAY\+\_\+\+MS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00168}{entered\+Pins}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00142}{Granted}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00180}{lcd\+Print\+Line()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00221}{make\+Entered\+Pins()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00053}{net}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00115}{PIN\+\_\+\+TIME\+\_\+\+MS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00146}{rfid\+Access}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00155}{show\+Text\+Until}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00152}{textshown}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00118}{UNLOCK\+\_\+\+TIME\+\_\+\+MS}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=341pt]{esp1__rfid__motion_8ino_ac3a129f66dc859e2b7279565f4e1de78_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=217pt]{esp1__rfid__motion_8ino_ac3a129f66dc859e2b7279565f4e1de78_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_aff8c04e7b324ff4272911924db174640}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!forceLock@{forceLock}}
\index{forceLock@{forceLock}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{forceLock()}{forceLock()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_aff8c04e7b324ff4272911924db174640} 
void force\+Lock (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Forces the system back into locked idle state. 

Resets access state, clears temporary flags, and restores the default idle LCD message. 

Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00206}{206}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}}\ =\ \textcolor{keyword}{false};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exit\ message\ display\ mode}}
\DoxyCodeLine{00208\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfidAccess}}\ =\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{AccessResult::Denied}};\ \ \ \ \ \textcolor{comment}{//\ Clear\ RFID\ authorization\ state}}
\DoxyCodeLine{00209\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a39d1ef76cb1d31fc16d855c63df5624a}{accessGranted}}\ =\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{AccessResult::Denied}};\ \ \textcolor{comment}{//\ Clear\ PIN\ authorization\ state}}
\DoxyCodeLine{00210\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Scan\ RFID\ card"{}}),\ 0);\ \ \textcolor{comment}{//\ Restore\ idle\ prompt}}
\DoxyCodeLine{00211\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00149}{access\+Granted}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00141}{Denied}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00180}{lcd\+Print\+Line()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00146}{rfid\+Access}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00152}{textshown}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=321pt]{esp1__rfid__motion_8ino_aff8c04e7b324ff4272911924db174640_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=218pt]{esp1__rfid__motion_8ino_aff8c04e7b324ff4272911924db174640_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_aee754d5a9a7adc964e2458c556d31728}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!handleRFID@{handleRFID}}
\index{handleRFID@{handleRFID}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{handleRFID()}{handleRFID()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_aee754d5a9a7adc964e2458c556d31728} 
void handle\+RFID (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Handles RFID card detection and request publishing. 

Detects new cards, reads UID, updates LCD, and sends an MQTT access request. 

Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{450}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \textcolor{comment}{//\ Exit\ if\ no\ new\ card\ is\ present}}
\DoxyCodeLine{00453\ \ \ \textcolor{keywordflow}{if}\ (!\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}}.PICC\_IsNewCardPresent())\ \{}
\DoxyCodeLine{00454\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00455\ \ \ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \textcolor{comment}{//\ Exit\ if\ card\ UID\ could\ not\ be\ read}}
\DoxyCodeLine{00458\ \ \ \textcolor{keywordflow}{if}\ (!\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}}.PICC\_ReadCardSerial())\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00460\ \ \ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \textcolor{keywordtype}{char}\ uidString[21];}
\DoxyCodeLine{00463\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ac37295ff76a33dc6395fbeb6906267fd}{uidToHexString}}(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}}.uid,\ uidString,\ \textcolor{keyword}{sizeof}(uidString));}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ Serial.println(uidString);}
\DoxyCodeLine{00466\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Connecting..."{}}),\ 0);}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00469\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{showTextUntil}}\ =\ millis()\ +\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b}{DISPLAY\_MS}};}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \textcolor{comment}{//\ Build\ JSON\ payload\ for\ access\ request}}
\DoxyCodeLine{00472\ \ \ StaticJsonDocument<64>\ data;}
\DoxyCodeLine{00473\ \ \ data[\textcolor{stringliteral}{"{}uid"{}}]\ =\ uidString;}
\DoxyCodeLine{00474\ \ \ data[\textcolor{stringliteral}{"{}event"{}}]\ =\ \textcolor{stringliteral}{"{}RFID\_Try"{}};}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \textcolor{comment}{//\ Publish\ access\ request\ via\ MQTT}}
\DoxyCodeLine{00477\ \ \ \textcolor{keywordtype}{bool}\ ok\ =\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.publishJson(\textcolor{stringliteral}{"{}access/request"{}},\ data);\ }
\DoxyCodeLine{00478\ \ \ Serial.println(ok\ ?\ \textcolor{stringliteral}{"{}MQTT\ publish\ OK"{}}\ :\ \textcolor{stringliteral}{"{}MQTT\ publish\ FAILED"{}});}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \textcolor{comment}{//\ Properly\ halt\ card\ communication}}
\DoxyCodeLine{00481\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}}.PICC\_HaltA();}
\DoxyCodeLine{00482\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}}.PCD\_StopCrypto1();}
\DoxyCodeLine{00483\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00109}{DISPLAY\+\_\+\+MS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00180}{lcd\+Print\+Line()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00053}{net}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00155}{show\+Text\+Until}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00152}{textshown}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00426}{uid\+To\+Hex\+String()}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=346pt]{esp1__rfid__motion_8ino_aee754d5a9a7adc964e2458c556d31728_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=227pt]{esp1__rfid__motion_8ino_aee754d5a9a7adc964e2458c556d31728_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_afd31f405375298b91360c711cad4200f}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!isDisplayActive@{isDisplayActive}}
\index{isDisplayActive@{isDisplayActive}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{isDisplayActive()}{isDisplayActive()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_afd31f405375298b91360c711cad4200f} 
bool is\+Display\+Active (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{now}{}\end{DoxyParamCaption})}



Checks whether the LCD backlight should remain active. 

Uses signed time comparison to safely handle millis() wraparound.


\begin{DoxyParams}{Parameters}
{\em now} & Current time in milliseconds. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if display is active, false otherwise. 
\end{DoxyReturn}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00363}{363}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{return}\ (int32\_t)(now\ -\/\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a25ac0b6f6c871d8fcaf0a438f1d8f46a}{showDisplayUntil}})\ <\ 0;}
\DoxyCodeLine{00365\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00158}{show\+Display\+Until}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00393}{on\+Motion\+Idle()}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_afd31f405375298b91360c711cad4200f_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!lcd@{lcd}}
\index{lcd@{lcd}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{lcd()}{lcd()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b} 
Liquid\+Crystal\+\_\+\+I2C lcd (\begin{DoxyParamCaption}\item[{\doxymbox{\hyperlink{esp1__rfid__motion_8ino_aa68f1d788c8105e0735aac60d3df262f}{LCD\+\_\+\+ADDRESS}}}]{}{, }\item[{\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a0e6a68e678ddbbb64d3a90350409eb77}{LCD\+\_\+\+COLUMNS}}}]{}{, }\item[{\doxymbox{\hyperlink{esp1__rfid__motion_8ino_ae8842648f085d102ff0d7b1f06896143}{LCD\+\_\+\+ROWS}}}]{}{}\end{DoxyParamCaption})}



I2C LCD instance. 



References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00102}{LCD\+\_\+\+ADDRESS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00096}{LCD\+\_\+\+COLUMNS}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00099}{LCD\+\_\+\+ROWS}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00180}{lcd\+Print\+Line()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00193}{lcd\+Print\+Line()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00374}{on\+Motion\+Detected()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00393}{on\+Motion\+Idle()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!lcdPrintLine@{lcdPrintLine}}
\index{lcdPrintLine@{lcdPrintLine}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{lcdPrintLine()}{lcdPrintLine()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450} 
void lcd\+Print\+Line (\begin{DoxyParamCaption}\item[{const \+\_\+\+\_\+\+Flash\+String\+Helper \texorpdfstring{$\ast$}{*}}]{msg}{, }\item[{uint8\+\_\+t}]{line}{}\end{DoxyParamCaption})}



Clears an LCD line and prints a flash-\/resident string. 


\begin{DoxyParams}{Parameters}
{\em msg} & Flash string (use F("{}..."{})). \\
\hline
{\em line} & LCD row index. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00180}{180}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00181\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.setCursor(0,\ line);}
\DoxyCodeLine{00182\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.print(\textcolor{stringliteral}{"{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}});\ \ \ \textcolor{comment}{//\ Overwrite\ entire\ row\ to\ remove\ old\ content}}
\DoxyCodeLine{00183\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.setCursor(0,\ line);}
\DoxyCodeLine{00184\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.print(msg);}
\DoxyCodeLine{00185\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00206}{force\+Lock()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=221pt]{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=343pt]{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_a79a958a99f2c3f644266594c7df27b97}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!lcdPrintLine@{lcdPrintLine}}
\index{lcdPrintLine@{lcdPrintLine}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{lcdPrintLine()}{lcdPrintLine()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a79a958a99f2c3f644266594c7df27b97} 
void lcd\+Print\+Line (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{msg}{, }\item[{uint8\+\_\+t}]{line}{}\end{DoxyParamCaption})}



Clears an LCD line and prints a RAM-\/resident string. 


\begin{DoxyParams}{Parameters}
{\em msg} & C-\/string to print. \\
\hline
{\em line} & LCD row index. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00193}{193}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00194\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.setCursor(0,\ line);}
\DoxyCodeLine{00195\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.print(\textcolor{stringliteral}{"{}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ "{}});\ \ \ \textcolor{comment}{//\ Clear\ row\ to\ avoid\ leftover\ characters}}
\DoxyCodeLine{00196\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.setCursor(0,\ line);}
\DoxyCodeLine{00197\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.print(msg);}
\DoxyCodeLine{00198\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=221pt]{esp1__rfid__motion_8ino_a79a958a99f2c3f644266594c7df27b97_cgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_afe461d27b9c48d5921c00d521181f12f}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!loop@{loop}}
\index{loop@{loop}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{loop()}{loop()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_afe461d27b9c48d5921c00d521181f12f} 
void loop (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Arduino main loop. 

Executes non-\/blocking system logic:\+
\begin{DoxyItemize}
\item MQTT client processing
\item Display timeout handling
\item Motion-\/based backlight control
\item RFID polling when active 
\end{DoxyItemize}

Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{546}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00547\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.loop();\ \ \ \ \ \textcolor{comment}{//\ Process\ MQTT\ traffic}}
\DoxyCodeLine{00548\ \ \ yield();\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Allow\ background\ WiFi\ tasks}}
\DoxyCodeLine{00549\ \ \ }
\DoxyCodeLine{00550\ \ \ \textcolor{keyword}{const}\ uint32\_t\ now\ =\ millis();}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \ \ \textcolor{comment}{//\ If\ a\ message\ is\ currently\ displayed,\ wait\ for\ timeout}}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}{textshown}})\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \textcolor{keywordflow}{if}\ ((int32\_t)(now\ -\/\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}{showTextUntil}})\ >=\ 0)\ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_aff8c04e7b324ff4272911924db174640}{forceLock}}();\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ system\ when\ timeout\ expires}}
\DoxyCodeLine{00556\ \ \ \ \ \}}
\DoxyCodeLine{00557\ \ \ \ \ delay(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af9d4cdbb45bf12608e163ee4b2d0dadd}{POLL\_MS}});}
\DoxyCodeLine{00558\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00559\ \ \ \}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \textcolor{comment}{//\ Update\ LCD\ backlight\ based\ on\ motion\ sensor}}
\DoxyCodeLine{00562\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8df5568d50795a11cfd7fb0abb331131}{updateMotionState}}(now);}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \ \ \textcolor{comment}{//\ Only\ allow\ RFID\ scans\ when\ display\ is\ active}}
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_afd31f405375298b91360c711cad4200f}{isDisplayActive}}(now))\ \{}
\DoxyCodeLine{00566\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_aee754d5a9a7adc964e2458c556d31728}{handleRFID}}();}
\DoxyCodeLine{00567\ \ \ \}}
\DoxyCodeLine{00568\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00206}{force\+Lock()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00363}{is\+Display\+Active()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00053}{net}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00121}{POLL\+\_\+\+MS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00155}{show\+Text\+Until}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00152}{textshown}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00407}{update\+Motion\+State()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_afe461d27b9c48d5921c00d521181f12f_cgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_ac8b922f2a416a064034b689152827cce}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!makeEnteredPins@{makeEnteredPins}}
\index{makeEnteredPins@{makeEnteredPins}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{makeEnteredPins()}{makeEnteredPins()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ac8b922f2a416a064034b689152827cce} 
void make\+Entered\+Pins (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{pin\+Length}{}\end{DoxyParamCaption})}



Builds a masked PIN string for LCD display. 

Converts a numeric PIN length into a visual representation using \textquotesingle{}\texorpdfstring{$\ast$}{*}\textquotesingle{} characters and trailing spaces.


\begin{DoxyParams}{Parameters}
{\em pin\+Length} & Number of digits entered so far. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00221}{221}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00222\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{comment}{//\ Clamp\ PIN\ length\ to\ display\ capacity\ (4\ digits)}}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordflow}{if}\ (pinLength\ >\ 4)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ pinLength\ =\ 4;}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ Fill\ entered\ portion\ with\ masking\ characters}}
\DoxyCodeLine{00229\ \ \ \ \ memset(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb}{enteredPins}},\ \textcolor{charliteral}{'*'},\ pinLength);}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{comment}{//\ Fill\ remaining\ positions\ with\ spaces\ to\ clear\ old\ characters}}
\DoxyCodeLine{00232\ \ \ \ \ memset(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb}{enteredPins}}\ +\ pinLength,\ \textcolor{charliteral}{'\ '},\ 4\ -\/\ pinLength);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ Ensure\ string\ is\ null-\/terminated}}
\DoxyCodeLine{00235\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb}{enteredPins}}[4]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00236\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00168}{entered\+Pins}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_ac8b922f2a416a064034b689152827cce_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!mfrc522@{mfrc522}}
\index{mfrc522@{mfrc522}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{mfrc522()}{mfrc522()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6} 
MFRC522 mfrc522 (\begin{DoxyParamCaption}\item[{\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a740060cb86c3a8429646211325d378cb}{RFID\+\_\+\+SS\+\_\+\+PIN}}}]{}{, }\item[{\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a5ddbb36ee43b0702d33a13226adfd364}{RFID\+\_\+\+RST\+\_\+\+PIN}}}]{}{}\end{DoxyParamCaption})}



MFRC522 RFID reader instance. 



References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00080}{RFID\+\_\+\+RST\+\_\+\+PIN}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00077}{RFID\+\_\+\+SS\+\_\+\+PIN}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=320pt]{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_ade59c900943c3305d0209fb836346d95}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!onMotionDetected@{onMotionDetected}}
\index{onMotionDetected@{onMotionDetected}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{onMotionDetected()}{onMotionDetected()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ade59c900943c3305d0209fb836346d95} 
void on\+Motion\+Detected (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{now}{}\end{DoxyParamCaption})}



Handles motion-\/detected events. 

Activates LCD backlight and refreshes display timeout.


\begin{DoxyParams}{Parameters}
{\em now} & Current time in milliseconds. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00374}{374}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{if}\ (!\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb}{motionActive}})\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb}{motionActive}}\ =\ \textcolor{keyword}{true};\ \ \ \ \ \ \ \textcolor{comment}{//\ Mark\ motion\ as\ active}}
\DoxyCodeLine{00377\ \ \ \ \ Serial.println(F(\textcolor{stringliteral}{"{}Motion\ detected"{}}));}
\DoxyCodeLine{00378\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.backlight();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Turn\ on\ LCD\ backlight}}
\DoxyCodeLine{00379\ \ \ \}}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \textcolor{comment}{//\ Extend\ backlight\ timeout\ while\ motion\ persists}}
\DoxyCodeLine{00382\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a25ac0b6f6c871d8fcaf0a438f1d8f46a}{showDisplayUntil}}\ =\ now\ +\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a7ac35d96245159cab011565a97a600a2}{DISPLAY\_BACKLIGHT\_MS}};}
\DoxyCodeLine{00383\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00112}{DISPLAY\+\_\+\+BACKLIGHT\+\_\+\+MS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00161}{motion\+Active}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00158}{show\+Display\+Until}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00407}{update\+Motion\+State()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=254pt]{esp1__rfid__motion_8ino_ade59c900943c3305d0209fb836346d95_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_ade59c900943c3305d0209fb836346d95_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_acafc4192a261b10303c3d691ac3f3340}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!onMotionIdle@{onMotionIdle}}
\index{onMotionIdle@{onMotionIdle}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{onMotionIdle()}{onMotionIdle()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_acafc4192a261b10303c3d691ac3f3340} 
void on\+Motion\+Idle (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{now}{}\end{DoxyParamCaption})}



Handles motion-\/idle state. 

Turns off LCD backlight when motion has ceased and the timeout has expired.


\begin{DoxyParams}{Parameters}
{\em now} & Current time in milliseconds. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00393}{393}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00394\ \ \ \textcolor{keywordflow}{if}\ (\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb}{motionActive}}\ \&\&\ !\doxymbox{\hyperlink{esp1__rfid__motion_8ino_afd31f405375298b91360c711cad4200f}{isDisplayActive}}(now))\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb}{motionActive}}\ =\ \textcolor{keyword}{false};\ \ \ \ \ \ \textcolor{comment}{//\ Mark\ motion\ as\ inactive}}
\DoxyCodeLine{00396\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.noBacklight();\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Turn\ off\ LCD\ backlight}}
\DoxyCodeLine{00397\ \ \ \}}
\DoxyCodeLine{00398\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00363}{is\+Display\+Active()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00161}{motion\+Active}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00407}{update\+Motion\+State()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=288pt]{esp1__rfid__motion_8ino_acafc4192a261b10303c3d691ac3f3340_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_acafc4192a261b10303c3d691ac3f3340_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_a4fc01d736fe50cf5b977f755b675f11d}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!setup@{setup}}
\index{setup@{setup}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{setup()}{setup()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a4fc01d736fe50cf5b977f755b675f11d} 
void setup (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Arduino setup function. 

Initializes hardware peripherals, LCD, Wi\+Fi, MQTT client, and topic subscriptions. 

Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{491}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00492\ \ \ delay(100);\ \textcolor{comment}{//\ Allow\ hardware\ to\ stabilize}}
\DoxyCodeLine{00493\ \ \ Serial.begin(115200);}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}{rfidAccess}}\ =\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{AccessResult::Denied}};}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ Wire.begin(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a63fd3c54e4843404005eeeb206227853}{I2C\_SDA\_PIN}},\ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a9f6ed03d2d1d74a449ea68a62185786b}{I2C\_SCL\_PIN}});}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.init();}
\DoxyCodeLine{00500\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.noBacklight();}
\DoxyCodeLine{00501\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd}}.clear();}
\DoxyCodeLine{00502\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a1eec526201dccd228883774259151450}{lcdPrintLine}}(F(\textcolor{stringliteral}{"{}Scan\ RFID\ card"{}}),\ 0);}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ SPI.begin();}
\DoxyCodeLine{00505\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522}}.PCD\_Init();}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00507\ \ \ Serial.println(\textcolor{stringliteral}{"{}RC522\ initialized"{}});}
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00509\ \ \ pinMode(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8e9966a29ec4b464131da8cb1825ceb5}{MOTION\_PIN}},\ INPUT);}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.begin(}
\DoxyCodeLine{00512\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ae4ee394ecd24781bba5d0aaaab8e964a}{WIFI\_SSID}},}
\DoxyCodeLine{00513\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a0495958e0c537c1c5100ee272495435c}{WIFI\_PASS}},}
\DoxyCodeLine{00514\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a41c34e432b12a511f9348547ddae11d4}{MQTT\_HOST}},}
\DoxyCodeLine{00515\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a993a7e0c0377e10146438ebe707f31d0}{MQTT\_PORT}},}
\DoxyCodeLine{00516\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a315cd313c3f6301b48d2f67e63bec2db}{MQTT\_USER}},}
\DoxyCodeLine{00517\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a31dacdc924feb376b49448eb843d053c}{MQTT\_PASS}},}
\DoxyCodeLine{00518\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a04ecc29c762e5b2844d3c24744813015}{DEVICE\_ID}},}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{stringliteral}{"{}site1"{}}}
\DoxyCodeLine{00520\ \ \ );}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ Serial.println(\textcolor{stringliteral}{"{}MQTT\ ready"{}});}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.setCallback(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_ac3a129f66dc859e2b7279565f4e1de78}{callback}});}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \textcolor{comment}{//\ Subscribe\ to\ required\ MQTT\ topics}}
\DoxyCodeLine{00527\ \ \ Serial.printf(\textcolor{stringliteral}{"{}access/response\ MQTT\ subscribe\ \%s\(\backslash\)n"{}},\ }
\DoxyCodeLine{00528\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.subscribe(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.makeTopic(\textcolor{stringliteral}{"{}access/response"{}}).c\_str())\ ?\ \textcolor{stringliteral}{"{}OK"{}}\ :\ \textcolor{stringliteral}{"{}FAILED"{}});}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \ \ Serial.printf(\textcolor{stringliteral}{"{}access/keypad\_response\ MQTT\ subscribe\ \%s\(\backslash\)n"{}},\ }
\DoxyCodeLine{00531\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.subscribe(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.makeTopic(\textcolor{stringliteral}{"{}access/keypad\_response"{}}).c\_str())\ ?\ \textcolor{stringliteral}{"{}OK"{}}\ :\ \textcolor{stringliteral}{"{}FAILED"{}});}
\DoxyCodeLine{00532\ \ \ }
\DoxyCodeLine{00533\ \ \ Serial.printf(\textcolor{stringliteral}{"{}keypad/beep\ MQTT\ subscribe\ \%s\(\backslash\)n"{}},\ }
\DoxyCodeLine{00534\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.subscribe(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}{net}}.makeTopic(\textcolor{stringliteral}{"{}keypad/beep"{}}).c\_str())\ ?\ \textcolor{stringliteral}{"{}OK"{}}\ :\ \textcolor{stringliteral}{"{}FAILED"{}});}
\DoxyCodeLine{00535\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00141}{Denied}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00070}{DEVICE\+\_\+\+ID}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00089}{I2\+C\+\_\+\+SCL\+\_\+\+PIN}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00086}{I2\+C\+\_\+\+SDA\+\_\+\+PIN}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00180}{lcd\+Print\+Line()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00083}{MOTION\+\_\+\+PIN}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00061}{MQTT\+\_\+\+HOST}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00067}{MQTT\+\_\+\+PASS}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00063}{MQTT\+\_\+\+PORT}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00065}{MQTT\+\_\+\+USER}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00053}{net}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00146}{rfid\+Access}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00058}{WIFI\+\_\+\+PASS}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00056}{WIFI\+\_\+\+SSID}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_a4fc01d736fe50cf5b977f755b675f11d_cgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_ac37295ff76a33dc6395fbeb6906267fd}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!uidToHexString@{uidToHexString}}
\index{uidToHexString@{uidToHexString}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{uidToHexString()}{uidToHexString()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ac37295ff76a33dc6395fbeb6906267fd} 
void uid\+To\+Hex\+String (\begin{DoxyParamCaption}\item[{const MFRC522::\+\+Uid \&}]{uid}{, }\item[{char \texorpdfstring{$\ast$}{*}}]{output}{, }\item[{size\+\_\+t}]{output\+Size}{}\end{DoxyParamCaption})}



Converts an RFID UID to a hexadecimal string. 

Each UID byte is encoded as two uppercase hexadecimal characters.


\begin{DoxyParams}{Parameters}
{\em uid} & MFRC522 UID structure. \\
\hline
{\em output} & Destination buffer. \\
\hline
{\em output\+Size} & Size of destination buffer. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00426}{426}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{comment}{//\ Ensure\ output\ buffer\ is\ large\ enough:}}
\DoxyCodeLine{00429\ \ \ \textcolor{comment}{//\ 2\ hex\ characters\ per\ byte\ +\ null\ terminator}}
\DoxyCodeLine{00430\ \ \ \textcolor{keywordflow}{if}\ (outputSize\ <\ (uid.size\ *\ 2\ +\ 1))\ \{}
\DoxyCodeLine{00431\ \ \ \ \ output[0]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};\ \ \textcolor{comment}{//\ Fail\ safely\ with\ empty\ string}}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00433\ \ \ \}}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \textcolor{comment}{//\ Convert\ each\ UID\ byte\ into\ two\ hex\ characters}}
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{byte}\ i\ =\ 0;\ i\ <\ uid.size;\ i++)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ sprintf(\&output[i\ *\ 2],\ \textcolor{stringliteral}{"{}\%02X"{}},\ uid.uidByte[i]);}
\DoxyCodeLine{00438\ \ \ \}}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \ \ \textcolor{comment}{//\ Explicitly\ terminate\ C-\/string}}
\DoxyCodeLine{00441\ \ \ output[uid.size\ *\ 2]\ =\ \textcolor{charliteral}{'\(\backslash\)0'};}
\DoxyCodeLine{00442\ \}}

\end{DoxyCode}


Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_ac37295ff76a33dc6395fbeb6906267fd_icgraph}
\end{center}
\end{figure}
\Hypertarget{esp1__rfid__motion_8ino_a8df5568d50795a11cfd7fb0abb331131}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!updateMotionState@{updateMotionState}}
\index{updateMotionState@{updateMotionState}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{updateMotionState()}{updateMotionState()}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a8df5568d50795a11cfd7fb0abb331131} 
void update\+Motion\+State (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{now}{}\end{DoxyParamCaption})}



Updates motion state based on PIR sensor input. 

Dispatches to motion-\/detected or motion-\/idle handlers.


\begin{DoxyParams}{Parameters}
{\em now} & Current time in milliseconds. \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00407}{407}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00408\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ motion\ =\ digitalRead(\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a8e9966a29ec4b464131da8cb1825ceb5}{MOTION\_PIN}});\ \ \textcolor{comment}{//\ Read\ PIR\ sensor\ state}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \textcolor{keywordflow}{if}\ (motion)\ \{}
\DoxyCodeLine{00411\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ade59c900943c3305d0209fb836346d95}{onMotionDetected}}(now);}
\DoxyCodeLine{00412\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00413\ \ \ \ \ \doxymbox{\hyperlink{esp1__rfid__motion_8ino_acafc4192a261b10303c3d691ac3f3340}{onMotionIdle}}(now);}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ \}}

\end{DoxyCode}


References \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00083}{MOTION\+\_\+\+PIN}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00374}{on\+Motion\+Detected()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00393}{on\+Motion\+Idle()}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino_a8df5568d50795a11cfd7fb0abb331131_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=264pt]{esp1__rfid__motion_8ino_a8df5568d50795a11cfd7fb0abb331131_icgraph}
\end{center}
\end{figure}


\label{doc-var-members}
\Hypertarget{esp1__rfid__motion_8ino_doc-var-members}
\doxysubsection{Variable Documentation}
\Hypertarget{esp1__rfid__motion_8ino_a39d1ef76cb1d31fc16d855c63df5624a}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!accessGranted@{accessGranted}}
\index{accessGranted@{accessGranted}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{accessGranted}{accessGranted}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a39d1ef76cb1d31fc16d855c63df5624a} 
\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} access\+Granted}



Result of PIN verification. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00149}{149}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00206}{force\+Lock()}}, and \doxymbox{\hyperlink{esp3_8ino_source_l00288}{force\+Lock()}}.

\Hypertarget{esp1__rfid__motion_8ino_a04ecc29c762e5b2844d3c24744813015}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!DEVICE\_ID@{DEVICE\_ID}}
\index{DEVICE\_ID@{DEVICE\_ID}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{DEVICE\_ID}{DEVICE\_ID}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a04ecc29c762e5b2844d3c24744813015} 
char DEVICE\+\_\+\+ID\+[$\,$]\+ = "{}door1"{}\hspace{0.3cm}{\ttfamily [constexpr]}}



Unique device identifier used in MQTT topics. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00070}{70}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a7ac35d96245159cab011565a97a600a2}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!DISPLAY\_BACKLIGHT\_MS@{DISPLAY\_BACKLIGHT\_MS}}
\index{DISPLAY\_BACKLIGHT\_MS@{DISPLAY\_BACKLIGHT\_MS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{DISPLAY\_BACKLIGHT\_MS}{DISPLAY\_BACKLIGHT\_MS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a7ac35d96245159cab011565a97a600a2} 
uint32\+\_\+t DISPLAY\+\_\+\+BACKLIGHT\+\_\+\+MS = 5000\hspace{0.3cm}{\ttfamily [constexpr]}}



Duration (ms) to keep LCD backlight on after motion. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00112}{112}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00374}{on\+Motion\+Detected()}}.

\Hypertarget{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!DISPLAY\_MS@{DISPLAY\_MS}}
\index{DISPLAY\_MS@{DISPLAY\_MS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{DISPLAY\_MS}{DISPLAY\_MS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a8241448199a71015eaefc1267dc8405b} 
uint32\+\_\+t DISPLAY\+\_\+\+MS = 3000\hspace{0.3cm}{\ttfamily [constexpr]}}



Duration (ms) to display text before resetting. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00109}{109}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}.

\Hypertarget{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!enteredPins@{enteredPins}}
\index{enteredPins@{enteredPins}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{enteredPins}{enteredPins}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_af36f6d1529914bff6ce2e463c7d131fb} 
char entered\+Pins\+[5]\+ = "{} "{}\hspace{0.3cm}{\ttfamily [static]}}



Masked PIN buffer shown on LCD (max 4 digits + null terminator). 

Filled with \textquotesingle{}\texorpdfstring{$\ast$}{*}\textquotesingle{} for entered digits and spaces for remaining slots. 

Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00168}{168}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00221}{make\+Entered\+Pins()}}.

\Hypertarget{esp1__rfid__motion_8ino_a9f6ed03d2d1d74a449ea68a62185786b}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!I2C\_SCL\_PIN@{I2C\_SCL\_PIN}}
\index{I2C\_SCL\_PIN@{I2C\_SCL\_PIN}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{I2C\_SCL\_PIN}{I2C\_SCL\_PIN}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a9f6ed03d2d1d74a449ea68a62185786b} 
uint8\+\_\+t I2\+C\+\_\+\+SCL\+\_\+\+PIN = 5\hspace{0.3cm}{\ttfamily [constexpr]}}



I2C SCL pin for LCD (D1 /\+ GPIO5). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00089}{89}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a63fd3c54e4843404005eeeb206227853}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!I2C\_SDA\_PIN@{I2C\_SDA\_PIN}}
\index{I2C\_SDA\_PIN@{I2C\_SDA\_PIN}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{I2C\_SDA\_PIN}{I2C\_SDA\_PIN}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a63fd3c54e4843404005eeeb206227853} 
uint8\+\_\+t I2\+C\+\_\+\+SDA\+\_\+\+PIN = 4\hspace{0.3cm}{\ttfamily [constexpr]}}



I2C SDA pin for LCD (D2 /\+ GPIO4). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00086}{86}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_aa68f1d788c8105e0735aac60d3df262f}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!LCD\_ADDRESS@{LCD\_ADDRESS}}
\index{LCD\_ADDRESS@{LCD\_ADDRESS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{LCD\_ADDRESS}{LCD\_ADDRESS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_aa68f1d788c8105e0735aac60d3df262f} 
uint8\+\_\+t LCD\+\_\+\+ADDRESS = 0x27\hspace{0.3cm}{\ttfamily [constexpr]}}



I2C address of the LCD module. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00102}{102}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}.

\Hypertarget{esp1__rfid__motion_8ino_a0e6a68e678ddbbb64d3a90350409eb77}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!LCD\_COLUMNS@{LCD\_COLUMNS}}
\index{LCD\_COLUMNS@{LCD\_COLUMNS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{LCD\_COLUMNS}{LCD\_COLUMNS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a0e6a68e678ddbbb64d3a90350409eb77} 
uint8\+\_\+t LCD\+\_\+\+COLUMNS = 16\hspace{0.3cm}{\ttfamily [constexpr]}}



Number of LCD columns. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00096}{96}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}.

\Hypertarget{esp1__rfid__motion_8ino_ae8842648f085d102ff0d7b1f06896143}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!LCD\_ROWS@{LCD\_ROWS}}
\index{LCD\_ROWS@{LCD\_ROWS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{LCD\_ROWS}{LCD\_ROWS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ae8842648f085d102ff0d7b1f06896143} 
uint8\+\_\+t LCD\+\_\+\+ROWS = 2\hspace{0.3cm}{\ttfamily [constexpr]}}



Number of LCD rows. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00099}{99}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_ab09e66ce429f1e2dd70e188a52754e2b}{lcd()}}.

\Hypertarget{esp1__rfid__motion_8ino_a8e9966a29ec4b464131da8cb1825ceb5}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!MOTION\_PIN@{MOTION\_PIN}}
\index{MOTION\_PIN@{MOTION\_PIN}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{MOTION\_PIN}{MOTION\_PIN}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a8e9966a29ec4b464131da8cb1825ceb5} 
uint8\+\_\+t MOTION\+\_\+\+PIN = 0\hspace{0.3cm}{\ttfamily [constexpr]}}



Motion sensor pin (D3 /\+ GPIO0). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00083}{83}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00407}{update\+Motion\+State()}}.

\Hypertarget{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!motionActive@{motionActive}}
\index{motionActive@{motionActive}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{motionActive}{motionActive}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a62fac6034c46ae1f6fc7511f4447decb} 
bool motion\+Active = false}



Indicates whether motion is currently considered active. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00161}{161}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00374}{on\+Motion\+Detected()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00393}{on\+Motion\+Idle()}}.

\Hypertarget{esp1__rfid__motion_8ino_a41c34e432b12a511f9348547ddae11d4}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!MQTT\_HOST@{MQTT\_HOST}}
\index{MQTT\_HOST@{MQTT\_HOST}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{MQTT\_HOST}{MQTT\_HOST}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a41c34e432b12a511f9348547ddae11d4} 
char MQTT\+\_\+\+HOST\+[$\,$]\+ = "{}maqiatto.\+com"{}\hspace{0.3cm}{\ttfamily [constexpr]}}



MQTT broker hostname. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00061}{61}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a31dacdc924feb376b49448eb843d053c}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!MQTT\_PASS@{MQTT\_PASS}}
\index{MQTT\_PASS@{MQTT\_PASS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{MQTT\_PASS}{MQTT\_PASS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a31dacdc924feb376b49448eb843d053c} 
char MQTT\+\_\+\+PASS\+[$\,$]\+ = "{}potter"{}\hspace{0.3cm}{\ttfamily [constexpr]}}



MQTT password. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00067}{67}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a993a7e0c0377e10146438ebe707f31d0}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!MQTT\_PORT@{MQTT\_PORT}}
\index{MQTT\_PORT@{MQTT\_PORT}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{MQTT\_PORT}{MQTT\_PORT}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a993a7e0c0377e10146438ebe707f31d0} 
uint16\+\_\+t MQTT\+\_\+\+PORT = 1883\hspace{0.3cm}{\ttfamily [constexpr]}}



MQTT broker port. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00063}{63}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a315cd313c3f6301b48d2f67e63bec2db}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!MQTT\_USER@{MQTT\_USER}}
\index{MQTT\_USER@{MQTT\_USER}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{MQTT\_USER}{MQTT\_USER}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a315cd313c3f6301b48d2f67e63bec2db} 
char MQTT\+\_\+\+USER\+[$\,$]\+ = "{}hectorfoss@gmail.\+com"{}\hspace{0.3cm}{\ttfamily [constexpr]}}



MQTT username. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00065}{65}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!net@{net}}
\index{net@{net}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{net}{net}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a082cbde9dbf32731aabec6f0b8a7e5c0} 
Wifi\+Mqtt\+Client net}



Wi\+Fi + MQTT client wrapper. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00053}{53}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}, \doxymbox{\hyperlink{esp2__keypad_8ino_source_l00244}{publish\+Tap()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a1437df78a60c0b4cbfba394adb0451d2}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!PIN\_TIME\_MS@{PIN\_TIME\_MS}}
\index{PIN\_TIME\_MS@{PIN\_TIME\_MS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{PIN\_TIME\_MS}{PIN\_TIME\_MS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a1437df78a60c0b4cbfba394adb0451d2} 
uint32\+\_\+t PIN\+\_\+\+TIME\+\_\+\+MS = 15000\hspace{0.3cm}{\ttfamily [constexpr]}}



Time window (ms) for entering PIN after RFID success. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00115}{115}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}.

\Hypertarget{esp1__rfid__motion_8ino_af9d4cdbb45bf12608e163ee4b2d0dadd}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!POLL\_MS@{POLL\_MS}}
\index{POLL\_MS@{POLL\_MS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{POLL\_MS}{POLL\_MS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_af9d4cdbb45bf12608e163ee4b2d0dadd} 
uint32\+\_\+t POLL\+\_\+\+MS = 30\hspace{0.3cm}{\ttfamily [constexpr]}}



Main loop polling delay (ms). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00121}{121}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}.

\Hypertarget{esp1__rfid__motion_8ino_a5ddbb36ee43b0702d33a13226adfd364}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!RFID\_RST\_PIN@{RFID\_RST\_PIN}}
\index{RFID\_RST\_PIN@{RFID\_RST\_PIN}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{RFID\_RST\_PIN}{RFID\_RST\_PIN}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a5ddbb36ee43b0702d33a13226adfd364} 
uint8\+\_\+t RFID\+\_\+\+RST\+\_\+\+PIN = 16\hspace{0.3cm}{\ttfamily [constexpr]}}



RC522 Reset pin (D0 /\+ GPIO16). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00080}{80}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522()}}.

\Hypertarget{esp1__rfid__motion_8ino_a740060cb86c3a8429646211325d378cb}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!RFID\_SS\_PIN@{RFID\_SS\_PIN}}
\index{RFID\_SS\_PIN@{RFID\_SS\_PIN}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{RFID\_SS\_PIN}{RFID\_SS\_PIN}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a740060cb86c3a8429646211325d378cb} 
uint8\+\_\+t RFID\+\_\+\+SS\+\_\+\+PIN = 15\hspace{0.3cm}{\ttfamily [constexpr]}}



RC522 SPI Slave Select pin (D8 /\+ GPIO15). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00077}{77}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_a2251823e12f034625cf955d83d4ec6b6}{mfrc522()}}.

\Hypertarget{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!rfidAccess@{rfidAccess}}
\index{rfidAccess@{rfidAccess}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{rfidAccess}{rfidAccess}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_af8cd458b5a58130e8dd244de49f9591d} 
\doxymbox{\hyperlink{esp1__rfid__motion_8ino_a6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} rfid\+Access}



Result of RFID authentication. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00146}{146}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00206}{force\+Lock()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_a25ac0b6f6c871d8fcaf0a438f1d8f46a}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!showDisplayUntil@{showDisplayUntil}}
\index{showDisplayUntil@{showDisplayUntil}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{showDisplayUntil}{showDisplayUntil}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a25ac0b6f6c871d8fcaf0a438f1d8f46a} 
uint32\+\_\+t show\+Display\+Until = 0}



Timestamp (ms) when LCD backlight should turn off. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00158}{158}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00363}{is\+Display\+Active()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00374}{on\+Motion\+Detected()}}.

\Hypertarget{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!showTextUntil@{showTextUntil}}
\index{showTextUntil@{showTextUntil}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{showTextUntil}{showTextUntil}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a04d3079f12f3e11e3bcb2b289c537093} 
uint32\+\_\+t show\+Text\+Until = 0}



Timestamp (ms) when the displayed text should expire. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00155}{155}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}.

\Hypertarget{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!textshown@{textshown}}
\index{textshown@{textshown}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{textshown}{textshown}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a7723000e87c672531aa82d5653686e61} 
bool textshown = false}



Indicates whether a status message is currently displayed. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00152}{152}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00206}{force\+Lock()}}, \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00450}{handle\+RFID()}}, and \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00546}{loop()}}.

\Hypertarget{esp1__rfid__motion_8ino_a6d6d37a1e68b6dcd10e646ed685f6f5e}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!UNLOCK\_TIME\_MS@{UNLOCK\_TIME\_MS}}
\index{UNLOCK\_TIME\_MS@{UNLOCK\_TIME\_MS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{UNLOCK\_TIME\_MS}{UNLOCK\_TIME\_MS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a6d6d37a1e68b6dcd10e646ed685f6f5e} 
uint32\+\_\+t UNLOCK\+\_\+\+TIME\+\_\+\+MS = 5000\hspace{0.3cm}{\ttfamily [constexpr]}}



Door unlock display duration (ms). 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00118}{118}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00250}{callback()}}.

\Hypertarget{esp1__rfid__motion_8ino_a0495958e0c537c1c5100ee272495435c}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!WIFI\_PASS@{WIFI\_PASS}}
\index{WIFI\_PASS@{WIFI\_PASS}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{WIFI\_PASS}{WIFI\_PASS}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_a0495958e0c537c1c5100ee272495435c} 
char WIFI\+\_\+\+PASS\+[$\,$]\+ = "{}mrbombasticcallmefantastic"{}\hspace{0.3cm}{\ttfamily [constexpr]}}



Wi\+Fi password. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00058}{58}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

\Hypertarget{esp1__rfid__motion_8ino_ae4ee394ecd24781bba5d0aaaab8e964a}\index{esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}!WIFI\_SSID@{WIFI\_SSID}}
\index{WIFI\_SSID@{WIFI\_SSID}!esp1\_rfid\_motion.ino@{esp1\_rfid\_motion.ino}}
\doxysubsubsection{\texorpdfstring{WIFI\_SSID}{WIFI\_SSID}}
{\footnotesize\ttfamily \label{esp1__rfid__motion_8ino_ae4ee394ecd24781bba5d0aaaab8e964a} 
char WIFI\+\_\+\+SSID\+[$\,$]\+ = "{}Mathias2.\+4"{}\hspace{0.3cm}{\ttfamily [constexpr]}}



Wi\+Fi SSID. 



Definition at line \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00056}{56}} of file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.



Referenced by \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source_l00491}{setup()}}.

