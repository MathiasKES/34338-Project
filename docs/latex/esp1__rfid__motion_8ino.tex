\doxysection{esp1\+\_\+rfid\+\_\+motion/\+esp1\+\_\+rfid\+\_\+motion.ino File Reference}
\hypertarget{esp1__rfid__motion_8ino}{}\label{esp1__rfid__motion_8ino}\index{esp1\_rfid\_motion/esp1\_rfid\_motion.ino@{esp1\_rfid\_motion/esp1\_rfid\_motion.ino}}


RFID + PIN based access controller with LCD, motion sensing, and MQTT.  


{\ttfamily \+\#include $<$Arduino.\+h$>$}\newline
{\ttfamily \+\#include $<$string.\+h$>$}\newline
{\ttfamily \+\#include $<$Arduino\+Json.\+h$>$}\newline
{\ttfamily \+\#include $<$SPI.\+h$>$}\newline
{\ttfamily \+\#include $<$MFRC522.\+h$>$}\newline
{\ttfamily \+\#include $<$Wire.\+h$>$}\newline
{\ttfamily \+\#include $<$Liquid\+Crystal\+\_\+\+I2\+C.\+h$>$}\newline
{\ttfamily \+\#include $<$Wi\+Fi\+Mqtt\+Client.\+h$>$}\newline
Include dependency graph for esp1\+\_\+rfid\+\_\+motion.\+ino:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{esp1__rfid__motion_8ino__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum class \doxymbox{\hyperlink{group__esp1_ga6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} :\+ uint8\+\_\+t \{ \doxymbox{\hyperlink{group__esp1_gga6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Access\+Result::\+\+Denied}}
, \doxymbox{\hyperlink{group__esp1_gga6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{Access\+Result::\+\+Granted}}
, \doxymbox{\hyperlink{group__esp1_gga6a8b3b75b2ade421c119d83a8b2133f1a58d036b9b7f0e7eb38cfb90f1cc70a73}{Access\+Result::\+\+Denied}}
, \doxymbox{\hyperlink{group__esp1_gga6a8b3b75b2ade421c119d83a8b2133f1ac322f9346b70efdd31968628d5ee68db}{Access\+Result::\+\+Granted}}
 \}
\begin{DoxyCompactList}\small\item\em Access result enumeration. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
MFRC522 \doxymbox{\hyperlink{group__esp1_ga2251823e12f034625cf955d83d4ec6b6}{mfrc522}} (\doxymbox{\hyperlink{group__esp1_ga740060cb86c3a8429646211325d378cb}{RFID\+\_\+\+SS\+\_\+\+PIN}}, \doxymbox{\hyperlink{group__esp1_ga5ddbb36ee43b0702d33a13226adfd364}{RFID\+\_\+\+RST\+\_\+\+PIN}})
\begin{DoxyCompactList}\small\item\em MFRC522 RFID reader instance. \end{DoxyCompactList}\item 
Liquid\+Crystal\+\_\+\+I2C \doxymbox{\hyperlink{group__esp1_gab09e66ce429f1e2dd70e188a52754e2b}{lcd}} (\doxymbox{\hyperlink{group__esp1_gaa68f1d788c8105e0735aac60d3df262f}{LCD\+\_\+\+ADDRESS}}, \doxymbox{\hyperlink{group__esp1_ga0e6a68e678ddbbb64d3a90350409eb77}{LCD\+\_\+\+COLUMNS}}, \doxymbox{\hyperlink{group__esp1_gae8842648f085d102ff0d7b1f06896143}{LCD\+\_\+\+ROWS}})
\begin{DoxyCompactList}\small\item\em I2C LCD instance. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_ga1eec526201dccd228883774259151450}{lcd\+Print\+Line}} (const \+\_\+\+\_\+\+Flash\+String\+Helper \texorpdfstring{$\ast$}{*}msg, uint8\+\_\+t line)
\begin{DoxyCompactList}\small\item\em Clears an LCD line and prints a flash-\/resident string. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_ga79a958a99f2c3f644266594c7df27b97}{lcd\+Print\+Line}} (const char \texorpdfstring{$\ast$}{*}msg, uint8\+\_\+t line)
\begin{DoxyCompactList}\small\item\em Clears an LCD line and prints a RAM-\/resident string. \end{DoxyCompactList}\item 
static void \doxymbox{\hyperlink{group__esp1_gaff8c04e7b324ff4272911924db174640}{force\+Lock}} ()
\begin{DoxyCompactList}\small\item\em Forces the system back into locked idle state. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gac8b922f2a416a064034b689152827cce}{make\+Entered\+Pins}} (uint8\+\_\+t pin\+Length)
\begin{DoxyCompactList}\small\item\em Builds a masked PIN string for LCD display. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gac3a129f66dc859e2b7279565f4e1de78}{callback}} (char \texorpdfstring{$\ast$}{*}topic, byte \texorpdfstring{$\ast$}{*}payload, unsigned int length)
\begin{DoxyCompactList}\small\item\em MQTT message callback handler. \end{DoxyCompactList}\item 
bool \doxymbox{\hyperlink{group__esp1_gafd31f405375298b91360c711cad4200f}{is\+Display\+Active}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Checks whether the LCD backlight should remain active. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gade59c900943c3305d0209fb836346d95}{on\+Motion\+Detected}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Handles motion-\/detected events. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gacafc4192a261b10303c3d691ac3f3340}{on\+Motion\+Idle}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Handles motion-\/idle state. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_ga8df5568d50795a11cfd7fb0abb331131}{update\+Motion\+State}} (uint32\+\_\+t now)
\begin{DoxyCompactList}\small\item\em Updates motion state based on PIR sensor input. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gac37295ff76a33dc6395fbeb6906267fd}{uid\+To\+Hex\+String}} (const MFRC522::\+\+Uid \&uid, char \texorpdfstring{$\ast$}{*}output, size\+\_\+t output\+Size)
\begin{DoxyCompactList}\small\item\em Converts an RFID UID to a hexadecimal string. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gaee754d5a9a7adc964e2458c556d31728}{handle\+RFID}} ()
\begin{DoxyCompactList}\small\item\em Handles RFID card detection and request publishing. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_ga4fc01d736fe50cf5b977f755b675f11d}{setup}} ()
\begin{DoxyCompactList}\small\item\em Arduino setup function. \end{DoxyCompactList}\item 
void \doxymbox{\hyperlink{group__esp1_gafe461d27b9c48d5921c00d521181f12f}{loop}} ()
\begin{DoxyCompactList}\small\item\em Arduino main loop. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\doxymbox{\hyperlink{classWifiMqttClient}{Wifi\+Mqtt\+Client}} \doxymbox{\hyperlink{group__esp1_ga082cbde9dbf32731aabec6f0b8a7e5c0}{net}}
\begin{DoxyCompactList}\small\item\em Wi\+Fi + MQTT client wrapper. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{group__esp1_gae4ee394ecd24781bba5d0aaaab8e964a}{WIFI\+\_\+\+SSID}} \+[$\,$]\+ = "{}Mathias2.\+4"{}
\begin{DoxyCompactList}\small\item\em Wi\+Fi SSID. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{group__esp1_ga0495958e0c537c1c5100ee272495435c}{WIFI\+\_\+\+PASS}} \+[$\,$]\+ = "{}mrbombasticcallmefantastic"{}
\begin{DoxyCompactList}\small\item\em Wi\+Fi password. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{group__esp1_ga41c34e432b12a511f9348547ddae11d4}{MQTT\+\_\+\+HOST}} \+[$\,$]\+ = "{}maqiatto.\+com"{}
\begin{DoxyCompactList}\small\item\em MQTT broker hostname. \end{DoxyCompactList}\item 
constexpr uint16\+\_\+t \doxymbox{\hyperlink{group__esp1_ga993a7e0c0377e10146438ebe707f31d0}{MQTT\+\_\+\+PORT}} = 1883
\begin{DoxyCompactList}\small\item\em MQTT broker port. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{group__esp1_ga315cd313c3f6301b48d2f67e63bec2db}{MQTT\+\_\+\+USER}} \+[$\,$]\+ = "{}hectorfoss@gmail.\+com"{}
\begin{DoxyCompactList}\small\item\em MQTT username. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{group__esp1_ga31dacdc924feb376b49448eb843d053c}{MQTT\+\_\+\+PASS}} \+[$\,$]\+ = "{}potter"{}
\begin{DoxyCompactList}\small\item\em MQTT password. \end{DoxyCompactList}\item 
constexpr char \doxymbox{\hyperlink{group__esp1_ga04ecc29c762e5b2844d3c24744813015}{DEVICE\+\_\+\+ID}} \+[$\,$]\+ = "{}door1"{}
\begin{DoxyCompactList}\small\item\em Unique device identifier used in MQTT topics. \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_ga740060cb86c3a8429646211325d378cb}{RFID\+\_\+\+SS\+\_\+\+PIN}} = 15
\begin{DoxyCompactList}\small\item\em RC522 SPI Slave Select pin (D8 /\+ GPIO15). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_ga5ddbb36ee43b0702d33a13226adfd364}{RFID\+\_\+\+RST\+\_\+\+PIN}} = 16
\begin{DoxyCompactList}\small\item\em RC522 Reset pin (D0 /\+ GPIO16). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_ga8e9966a29ec4b464131da8cb1825ceb5}{MOTION\+\_\+\+PIN}} = 0
\begin{DoxyCompactList}\small\item\em Motion sensor pin (D3 /\+ GPIO0). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_ga63fd3c54e4843404005eeeb206227853}{I2\+C\+\_\+\+SDA\+\_\+\+PIN}} = 4
\begin{DoxyCompactList}\small\item\em I2C SDA pin for LCD (D2 /\+ GPIO4). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_ga9f6ed03d2d1d74a449ea68a62185786b}{I2\+C\+\_\+\+SCL\+\_\+\+PIN}} = 5
\begin{DoxyCompactList}\small\item\em I2C SCL pin for LCD (D1 /\+ GPIO5). \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_ga0e6a68e678ddbbb64d3a90350409eb77}{LCD\+\_\+\+COLUMNS}} = 16
\begin{DoxyCompactList}\small\item\em Number of LCD columns. \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_gae8842648f085d102ff0d7b1f06896143}{LCD\+\_\+\+ROWS}} = 2
\begin{DoxyCompactList}\small\item\em Number of LCD rows. \end{DoxyCompactList}\item 
constexpr uint8\+\_\+t \doxymbox{\hyperlink{group__esp1_gaa68f1d788c8105e0735aac60d3df262f}{LCD\+\_\+\+ADDRESS}} = 0x27
\begin{DoxyCompactList}\small\item\em I2C address of the LCD module. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_ga8241448199a71015eaefc1267dc8405b}{DISPLAY\+\_\+\+MS}} = 3000
\begin{DoxyCompactList}\small\item\em Duration (ms) to display text before resetting. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_ga7ac35d96245159cab011565a97a600a2}{DISPLAY\+\_\+\+BACKLIGHT\+\_\+\+MS}} = 5000
\begin{DoxyCompactList}\small\item\em Duration (ms) to keep LCD backlight on after motion. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_ga1437df78a60c0b4cbfba394adb0451d2}{PIN\+\_\+\+TIME\+\_\+\+MS}} = 15000
\begin{DoxyCompactList}\small\item\em Time window (ms) for entering PIN after RFID success. \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_ga6d6d37a1e68b6dcd10e646ed685f6f5e}{UNLOCK\+\_\+\+TIME\+\_\+\+MS}} = 5000
\begin{DoxyCompactList}\small\item\em Door unlock display duration (ms). \end{DoxyCompactList}\item 
constexpr uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_gaf9d4cdbb45bf12608e163ee4b2d0dadd}{POLL\+\_\+\+MS}} = 30
\begin{DoxyCompactList}\small\item\em Main loop polling delay (ms). \end{DoxyCompactList}\item 
\doxymbox{\hyperlink{group__esp1_ga6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} \doxymbox{\hyperlink{group__esp1_gaf8cd458b5a58130e8dd244de49f9591d}{rfid\+Access}}
\begin{DoxyCompactList}\small\item\em Result of RFID authentication. \end{DoxyCompactList}\item 
\doxymbox{\hyperlink{group__esp1_ga6a8b3b75b2ade421c119d83a8b2133f1}{Access\+Result}} \doxymbox{\hyperlink{group__esp1_ga39d1ef76cb1d31fc16d855c63df5624a}{access\+Granted}}
\begin{DoxyCompactList}\small\item\em Result of PIN verification. \end{DoxyCompactList}\item 
bool \doxymbox{\hyperlink{group__esp1_ga7723000e87c672531aa82d5653686e61}{textshown}} = false
\begin{DoxyCompactList}\small\item\em Indicates whether a status message is currently displayed. \end{DoxyCompactList}\item 
uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_ga04d3079f12f3e11e3bcb2b289c537093}{show\+Text\+Until}} = 0
\begin{DoxyCompactList}\small\item\em Timestamp (ms) when the displayed text should expire. \end{DoxyCompactList}\item 
uint32\+\_\+t \doxymbox{\hyperlink{group__esp1_ga25ac0b6f6c871d8fcaf0a438f1d8f46a}{show\+Display\+Until}} = 0
\begin{DoxyCompactList}\small\item\em Timestamp (ms) when LCD backlight should turn off. \end{DoxyCompactList}\item 
bool \doxymbox{\hyperlink{group__esp1_ga62fac6034c46ae1f6fc7511f4447decb}{motion\+Active}} = false
\begin{DoxyCompactList}\small\item\em Indicates whether motion is currently considered active. \end{DoxyCompactList}\item 
static char \doxymbox{\hyperlink{group__esp1_gaf36f6d1529914bff6ce2e463c7d131fb}{entered\+Pins}} \+[5]\+ = "{} "{}
\begin{DoxyCompactList}\small\item\em Masked PIN buffer shown on LCD (max 4 digits + null terminator). \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
RFID + PIN based access controller with LCD, motion sensing, and MQTT. 



Definition in file \doxymbox{\hyperlink{esp1__rfid__motion_8ino_source}{esp1\+\_\+rfid\+\_\+motion.\+ino}}.

